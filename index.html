<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultra Stream - 60fps</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            color: #fff; 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            height: 100vh; 
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain;
            background: #000;
        }

        #selfView {
            position: absolute;
            bottom: 120px;
            right: 20px;
            width: 140px;
            height: 180px;
            border-radius: 12px;
            border: 3px solid #00ff88;
            object-fit: cover;
            z-index: 10;
            display: none;
            box-shadow: 0 8px 32px rgba(0,255,136,0.3);
        }
        
        .panel { 
            position: fixed; 
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100; 
            background: rgba(15,15,15,0.98); 
            padding: 40px; 
            border-radius: 20px; 
            text-align: center; 
            width: 90%; 
            max-width: 450px;
            border: 2px solid #00ff88;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        h2 { 
            margin-bottom: 20px; 
            background: linear-gradient(135deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 28px;
            font-weight: 800;
        }

        .input-group {
            margin: 15px 0;
            text-align: left;
        }

        .input-label {
            display: block;
            font-size: 12px;
            color: #00ff88;
            margin-bottom: 5px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        select, input[type="text"] { 
            width: 100%; 
            padding: 16px; 
            border-radius: 10px; 
            border: 2px solid #333; 
            background: #1a1a1a; 
            color: #fff; 
            font-size: 15px;
            transition: all 0.3s;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0,255,136,0.2);
        }

        .quality-info {
            font-size: 11px;
            color: #888;
            margin-top: 5px;
        }

        .btn { 
            width: 100%; 
            padding: 18px; 
            margin: 10px 0;
            cursor: pointer; 
            border: none; 
            border-radius: 12px; 
            font-weight: 700; 
            font-size: 16px; 
            color: #fff;
            transition: all 0.3s;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-host { 
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            box-shadow: 0 5px 20px rgba(0,255,136,0.4);
        }
        
        .btn-viewer { 
            background: linear-gradient(135deg, #00ccff, #0088ff);
            box-shadow: 0 5px 20px rgba(0,204,255,0.4);
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            display: none;
            gap: 15px;
            background: rgba(0,0,0,0.8);
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid #333;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:active {
            transform: scale(0.9);
        }

        .mic { background: linear-gradient(135deg, #ff4757, #ff6348); }
        .cam { background: linear-gradient(135deg, #ffa502, #ff6348); }
        .end { background: linear-gradient(135deg, #ee5a6f, #c44569); }
        .quality-control { background: linear-gradient(135deg, #00ccff, #0088ff); font-size: 16px; }
        .off { background: #333; opacity: 0.5; }

        .stats-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.95);
            padding: 20px;
            border-radius: 15px;
            font-size: 13px;
            z-index: 10;
            display: none;
            min-width: 280px;
            border: 2px solid #00ff88;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #888;
            font-weight: 600;
        }

        .stat-value {
            color: #00ff88;
            font-weight: 700;
            font-family: monospace;
        }

        .live-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff4757, #ff0844);
            color: #fff;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 800;
            font-size: 13px;
            display: none;
            z-index: 10;
            box-shadow: 0 5px 25px rgba(255,8,68,0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .status-bar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.95);
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            z-index: 10;
            display: none;
            border: 2px solid #00ff88;
        }

        .quality-selector {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.98);
            padding: 30px;
            border-radius: 20px;
            z-index: 200;
            display: none;
            border: 2px solid #00ff88;
            min-width: 300px;
        }

        .quality-option {
            padding: 15px;
            margin: 10px 0;
            background: #1a1a1a;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid #333;
            transition: all 0.3s;
        }

        .quality-option:active {
            border-color: #00ff88;
            background: #222;
        }

        .session-summary {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.98);
            padding: 40px;
            border-radius: 20px;
            z-index: 300;
            display: none;
            border: 2px solid #00ff88;
            min-width: 350px;
            text-align: center;
        }

        .summary-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #00ff88;
        }

        .summary-stat {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 16px;
        }

        .data-usage {
            font-size: 32px;
            color: #00ccff;
            font-weight: 800;
            margin: 20px 0;
        }

        .hidden { display: none !important; }

        .fps-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 16px;
            display: none;
            z-index: 10;
            box-shadow: 0 5px 20px rgba(0,255,136,0.5);
        }

        .chart-container {
            width: 100%;
            height: 60px;
            margin-top: 15px;
            position: relative;
            background: #0a0a0a;
            border-radius: 8px;
            overflow: hidden;
        }

        .chart-bar {
            position: absolute;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to top, #00ff88, #00ccff);
            transition: height 0.3s;
        }
    </style>
</head>
<body>

    <div class="video-container">
        <video id="mainVideo" autoplay playsinline muted></video>
        <video id="selfView" autoplay playsinline muted></video>
    </div>

    <div id="statsPanel" class="stats-panel">
        <div style="font-size: 16px; font-weight: 800; margin-bottom: 15px; color: #00ff88;">üìä ƒ∞STATƒ∞STƒ∞KLER</div>
        <div class="stat-row">
            <span class="stat-label">FPS</span>
            <span class="stat-value" id="fps">-</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">√á√∂z√ºn√ºrl√ºk</span>
            <span class="stat-value" id="resolution">-</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Bitrate</span>
            <span class="stat-value" id="bitrate">-</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Paket Kaybƒ±</span>
            <span class="stat-value" id="packetLoss">-</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Gecikme</span>
            <span class="stat-value" id="latency">-</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Veri</span>
            <span class="stat-value" id="dataUsage">0 MB</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">S√ºre</span>
            <span class="stat-value" id="duration">00:00</span>
        </div>
        <div class="chart-container" id="bitrateChart"></div>
    </div>

    <div id="liveIndicator" class="live-indicator">üî¥ CANLI</div>
    <div id="fpsBadge" class="fps-badge">60 FPS</div>

    <div id="ui" class="panel">
        <h2>‚ö° Ultra Stream</h2>
        
        <div class="input-group">
            <label class="input-label">üîë Oda Adƒ±</label>
            <input type="text" id="room" placeholder="Oda adƒ± girin">
        </div>
        
        <div class="input-group">
            <label class="input-label">üé® Kalite</label>
            <select id="quality">
                <option value="720p60">HD 60fps (1280x720) - √ñnerilen</option>
                <option value="1080p60">Full HD 60fps (1920x1080)</option>
                <option value="480p60">SD 60fps (854x480) - D√º≈ü√ºk</option>
            </select>
            <div class="quality-info">üí° 60fps garantili</div>
        </div>

        <p style="color:#00ff88; font-size:13px; margin:20px 0 10px 0; font-weight:700;">üì± YAYINCI</p>
        <button class="btn btn-host" onclick="startHost()">üöÄ YAYINI BA≈ûLAT</button>

        <p style="color:#00ccff; font-size:13px; margin:20px 0 10px 0; font-weight:700;">üíª ƒ∞ZLEYƒ∞Cƒ∞</p>
        <button class="btn btn-viewer" onclick="startViewer()">üëÅÔ∏è ƒ∞ZLE</button>
    </div>

    <div id="statusBar" class="status-bar">Hazƒ±r</div>

    <div id="controls" class="controls">
        <button class="control-btn mic" id="micBtn" onclick="toggleMic()">üé§</button>
        <button class="control-btn cam" id="camBtn" onclick="toggleCam()">üìπ</button>
        <button class="control-btn quality-control" id="qualityBtn" onclick="showQualitySelector()">‚öôÔ∏è</button>
        <button class="control-btn end" onclick="endCall()">‚ùå</button>
    </div>

    <div id="qualitySelector" class="quality-selector">
        <h3 style="color:#00ff88; margin-bottom:20px;">üéØ Kalite Deƒüi≈ütir</h3>
        <div class="quality-option" onclick="changeQuality('1080p60')">
            <strong>Full HD 60fps</strong><br>
            <small>1920x1080 @ 60fps</small>
        </div>
        <div class="quality-option" onclick="changeQuality('720p60')">
            <strong>HD 60fps</strong><br>
            <small>1280x720 @ 60fps</small>
        </div>
        <div class="quality-option" onclick="changeQuality('480p60')">
            <strong>SD 60fps</strong><br>
            <small>854x480 @ 60fps</small>
        </div>
        <button class="btn btn-host" onclick="closeQualitySelector()" style="margin-top:15px;">‚úì Kapat</button>
    </div>

    <div id="sessionSummary" class="session-summary">
        <div class="summary-title">üìä Yayƒ±n √ñzeti</div>
        <div class="summary-stat">
            <span>S√ºre:</span>
            <span id="totalDuration">-</span>
        </div>
        <div class="summary-stat">
            <span>Ort. FPS:</span>
            <span id="avgFps">-</span>
        </div>
        <div class="summary-stat">
            <span>Ort. Bitrate:</span>
            <span id="avgBitrate">-</span>
        </div>
        <div class="data-usage" id="totalData">- MB</div>
        <div style="font-size:12px; color:#888; margin-bottom:20px;">Toplam Veri</div>
        <button class="btn btn-host" onclick="location.reload()">üîÑ Yeni Yayƒ±n</button>
    </div>

    <script>
        console.log('‚úì Script ba≈ülatƒ±ldƒ±');
        
        var peer, localStream, currentCall;
        var isHost = false;
        var micOn = true, camOn = true;
        var currentQuality = '720p60';
        
        var startTime = null;
        var totalBytes = 0;
        var fpsHistory = [];
        var bitrateHistory = [];
        var lastBytesReceived = 0;
        var lastBytesReceivedTime = 0;
        
        var config = {
            config: {
                iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun1.l.google.com:19302' }
                ]
            }
        };

        var qualityPresets = {
            '1080p60': { width: 1920, height: 1080, frameRate: 60 },
            '720p60': { width: 1280, height: 720, frameRate: 60 },
            '480p60': { width: 854, height: 480, frameRate: 60 }
        };

        function getConstraints(quality) {
            var preset = qualityPresets[quality] || qualityPresets['720p60'];
            return {
                width: { ideal: preset.width },
                height: { ideal: preset.height },
                frameRate: { ideal: 60, min: 30 }
            };
        }

        function startHost() {
            console.log('üé¨ startHost √ßaƒürƒ±ldƒ±');
            var room = getRoom();
            if (!room) return;

            isHost = true;
            currentQuality = document.getElementById('quality').value;
            showStatus("üé• Kamera a√ßƒ±lƒ±yor...");

            var vc = getConstraints(currentQuality);
            
            var constraints = { 
                video: { 
                    facingMode: { ideal: "environment" },
                    width: vc.width,
                    height: vc.height,
                    frameRate: vc.frameRate
                }, 
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true,
                    autoGainControl: true
                }
            };

            console.log('üìπ getUserMedia √ßaƒürƒ±lƒ±yor:', constraints);
            
            navigator.mediaDevices.getUserMedia(constraints)
            .then(function(stream) {
                console.log('‚úì Stream alƒ±ndƒ±');
                localStream = stream;
                
                var videoTrack = stream.getVideoTracks()[0];
                var settings = videoTrack.getSettings();
                console.log('Video ayarlarƒ±:', settings);
                
                document.getElementById('selfView').srcObject = stream;
                document.getElementById('selfView').style.display = 'block';

                hideUI();
                document.getElementById('liveIndicator').style.display = 'block';
                document.getElementById('fpsBadge').style.display = 'block';
                showStatus("üì° Baƒülanƒ±yor...");

                peer = new Peer(room + "-host", config);

                peer.on('open', function(id) {
                    console.log('‚úì Peer a√ßƒ±ldƒ±:', id);
                    showStatus("‚úÖ HAZIR - ƒ∞zleyici bekleniyor");
                    startTime = Date.now();
                    connectViewer(room + "-viewer");
                });

                peer.on('call', function(call) {
                    console.log('üìû √áaƒürƒ± alƒ±ndƒ±');
                    call.answer(stream);
                    currentCall = call;
                    
                    call.on('stream', function(remoteStream) {
                        console.log('üîä Uzak ses alƒ±ndƒ±');
                        var audio = new Audio();
                        audio.srcObject = remoteStream;
                        audio.play().catch(function(e) {
                            console.log('Ses oynatma hatasƒ±:', e);
                        });
                        showStatus("üî• YAYINDA!");
                        startStats();
                    });
                });

                peer.on('error', function(err) {
                    console.error('Peer hatasƒ±:', err);
                    handlePeerError(err);
                });
            })
            .catch(function(err) {
                console.error('‚ùå getUserMedia hatasƒ±:', err);
                alert("Kamera Hatasƒ±: " + err.name + " - " + err.message);
            });
        }

        function connectViewer(viewerId) {
            if (!peer || !localStream) return;
            
            var call = peer.call(viewerId, localStream);
            
            if (call) {
                currentCall = call;
                
                call.on('stream', function(remoteStream) {
                    var audio = new Audio();
                    audio.srcObject = remoteStream;
                    audio.play();
                    showStatus("üî• CANLI!");
                    startStats();
                });

                call.on('close', function() {
                    setTimeout(function() { connectViewer(viewerId); }, 2000);
                });
            } else {
                setTimeout(function() { connectViewer(viewerId); }, 2000);
            }
        }

        function startViewer() {
            var room = getRoom();
            if (!room) return;

            isHost = false;
            showStatus("üé§ Mikrofon a√ßƒ±lƒ±yor...");

            navigator.mediaDevices.getUserMedia({ 
                video: false,
                audio: true
            })
            .then(function(stream) {
                localStream = stream;

                hideUI();
                document.getElementById('camBtn').style.display = 'none';
                document.getElementById('qualityBtn').style.display = 'none';
                showStatus("üì° Baƒülanƒ±yor...");

                peer = new Peer(room + "-viewer", config);

                peer.on('open', function(id) {
                    showStatus("‚úÖ Hazƒ±r");
                    startTime = Date.now();
                });

                peer.on('call', function(call) {
                    showStatus("üì• Alƒ±nƒ±yor...");
                    call.answer(stream);
                    currentCall = call;

                    call.on('stream', function(remoteStream) {
                        var mainVid = document.getElementById('mainVideo');
                        mainVid.srcObject = remoteStream;
                        mainVid.muted = false;
                        
                        mainVid.play()
                            .then(function() {
                                showStatus("üé¨ ƒ∞ZLENƒ∞YOR");
                                document.getElementById('fpsBadge').style.display = 'block';
                                startStats();
                            })
                            .catch(function() {
                                showStatus("‚ñ∂Ô∏è Tƒ±kla");
                            });
                    });
                });

                peer.on('error', handlePeerError);
            })
            .catch(function(err) {
                alert("Mikrofon Hatasƒ±: " + err.message);
            });
        }

        function startStats() {
            if (!currentCall || !currentCall.peerConnection) return;

            document.getElementById('statsPanel').style.display = 'block';
            
            var chartContainer = document.getElementById('bitrateChart');
            chartContainer.innerHTML = '';
            for (var i = 0; i < 50; i++) {
                var bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.left = (i * 2) + '%';
                chartContainer.appendChild(bar);
            }

            setInterval(function() {
                if (!currentCall || !currentCall.peerConnection) return;

                currentCall.peerConnection.getStats().then(function(stats) {
                    stats.forEach(function(report) {
                        if (report.type === 'inbound-rtp' && report.kind === 'video') {
                            var currentFps = Math.round(report.framesPerSecond || 0);
                            
                            var bytesReceived = report.bytesReceived || 0;
                            var timestamp = report.timestamp || Date.now();
                            
                            if (lastBytesReceivedTime > 0) {
                                var timeDiff = (timestamp - lastBytesReceivedTime) / 1000;
                                var bytesDiff = bytesReceived - lastBytesReceived;
                                var currentBitrate = Math.round((bytesDiff * 8) / timeDiff / 1000);
                                
                                bitrateHistory.push(currentBitrate);
                                if (bitrateHistory.length > 50) bitrateHistory.shift();
                                
                                document.getElementById('bitrate').textContent = currentBitrate + ' kbps';
                            }
                            
                            lastBytesReceived = bytesReceived;
                            lastBytesReceivedTime = timestamp;
                            totalBytes = bytesReceived;
                            
                            document.getElementById('fps').textContent = currentFps + ' fps';
                            document.getElementById('fpsBadge').textContent = currentFps + ' FPS';
                            document.getElementById('resolution').textContent = 
                                (report.frameWidth || 0) + 'x' + (report.frameHeight || 0);
                            
                            var packetsLost = report.packetsLost || 0;
                            var packetsReceived = report.packetsReceived || 1;
                            var lossPercent = ((packetsLost / packetsReceived) * 100).toFixed(2);
                            document.getElementById('packetLoss').textContent = lossPercent + '%';
                            
                            fpsHistory.push(currentFps);
                            if (fpsHistory.length > 100) fpsHistory.shift();
                            
                            updateBitrateChart();
                        }
                        
                        if (report.type === 'candidate-pair' && report.state === 'succeeded') {
                            var currentLatency = Math.round(report.currentRoundTripTime * 1000) || 0;
                            document.getElementById('latency').textContent = currentLatency + ' ms';
                        }
                    });
                    
                    var dataMB = (totalBytes / (1024 * 1024)).toFixed(2);
                    document.getElementById('dataUsage').textContent = dataMB + ' MB';
                    
                    if (startTime) {
                        var elapsed = Math.floor((Date.now() - startTime) / 1000);
                        var minutes = Math.floor(elapsed / 60);
                        var seconds = elapsed % 60;
                        document.getElementById('duration').textContent = 
                            String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
                    }
                });
            }, 1000);
        }

        function updateBitrateChart() {
            var bars = document.querySelectorAll('.chart-bar');
            var maxBitrate = Math.max.apply(Math, bitrateHistory) || 1;
            
            bitrateHistory.forEach(function(value, index) {
                if (bars[index]) {
                    var heightPercent = (value / maxBitrate) * 100;
                    bars[index].style.height = heightPercent + '%';
                }
            });
        }

        function showQualitySelector() {
            document.getElementById('qualitySelector').style.display = 'block';
        }

        function closeQualitySelector() {
            document.getElementById('qualitySelector').style.display = 'none';
        }

        function changeQuality(newQuality) {
            if (!isHost || !localStream) return;
            
            currentQuality = newQuality;
            showStatus("‚öôÔ∏è Deƒüi≈ütiriliyor...");
            closeQualitySelector();
            
            var vc = getConstraints(newQuality);
            var videoTrack = localStream.getVideoTracks()[0];
            
            videoTrack.applyConstraints({
                width: vc.width,
                height: vc.height,
                frameRate: vc.frameRate
            })
            .then(function() {
                showStatus("‚úÖ G√ºncellendi");
                setTimeout(function() {
                    showStatus("üî• CANLI!");
                }, 2000);
            })
            .catch(function(err) {
                console.error('Kalite hatasƒ±:', err);
                showStatus("‚ö†Ô∏è Ba≈üarƒ±sƒ±z");
            });
        }

        function toggleMic() {
            if (!localStream) return;
            
            var track = localStream.getAudioTracks()[0];
            if (track) {
                micOn = !micOn;
                track.enabled = micOn;
                var btn = document.getElementById('micBtn');
                btn.className = micOn ? 'control-btn mic' : 'control-btn mic off';
                btn.textContent = micOn ? 'üé§' : 'üîá';
            }
        }

        function toggleCam() {
            if (!localStream || !isHost) return;
            
            var track = localStream.getVideoTracks()[0];
            if (track) {
                camOn = !camOn;
                track.enabled = camOn;
                var btn = document.getElementById('camBtn');
                btn.className = camOn ? 'control-btn cam' : 'control-btn cam off';
                btn.textContent = camOn ? 'üìπ' : 'üì∑';
            }
        }

        function endCall() {
            showSessionSummary();
        }

        function showSessionSummary() {
            if (startTime) {
                var elapsed = Math.floor((Date.now() - startTime) / 1000);
                var minutes = Math.floor(elapsed / 60);
                var seconds = elapsed % 60;
                document.getElementById('totalDuration').textContent = 
                    minutes + ' dk ' + seconds + ' sn';
                
                var avgFps = fpsHistory.length > 0 
                    ? Math.round(fpsHistory.reduce(function(a, b) { return a + b; }, 0) / fpsHistory.length)
                    : 0;
                document.getElementById('avgFps').textContent = avgFps + ' fps';
                
                var avgBitrate = bitrateHistory.length > 0
                    ? Math.round(bitrateHistory.reduce(function(a, b) { return a + b; }, 0) / bitrateHistory.length)
                    : 0;
                document.getElementById('avgBitrate').textContent = avgBitrate + ' kbps';
                
                var dataMB = (totalBytes / (1024 * 1024)).toFixed(2);
                document.getElementById('totalData').textContent = dataMB + ' MB';
                
                document.getElementById('sessionSummary').style.display = 'block';
            }
            
            if (currentCall) currentCall.close();
            if (localStream) {
                localStream.getTracks().forEach(function(track) {
                    track.stop();
                });
            }
            if (peer) peer.destroy();
        }

        function handlePeerError(err) {
            console.log('Peer hatasƒ±:', err);
            if (err.type === 'peer-unavailable') {
                setTimeout(function() {
                    var room = document.getElementById('room').value.trim();
                    if (isHost) {
                        connectViewer(room + "-viewer");
                    }
                }, 2000);
            }
        }

        function getRoom() {
            var r = document.getElementById('room').value.trim();
            if (r.length < 2) { 
                alert("En az 2 karakter!"); 
                return null; 
            }
            return r.toLowerCase().replace(/[^a-z0-9]/g, '');
        }

        function showStatus(msg) {
            var el = document.getElementById('statusBar');
            el.style.display = 'block';
            el.textContent = msg;
        }

        function hideUI() {
            document.getElementById('ui').className = 'panel hidden';
            document.getElementById('controls').style.display = 'flex';
        }

        // ƒ∞zin kontrol√º
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            console.log('‚úì getUserMedia destekleniyor');
        } else {
            console.error('‚ùå getUserMedia desteklenmiyor');
            alert('Tarayƒ±cƒ±nƒ±z kamera eri≈üimini desteklemiyor!');
        }

        // Sayfa y√ºklendiƒüinde
        window.addEventListener('load', function() {
            console.log('‚úì Sayfa y√ºklendi');
        });
    </script>
</body>
</html>
